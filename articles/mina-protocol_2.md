---
title: "o1jsã‚’ä½¿ã£ã¦ç½²åãƒ»æ¤œè¨¼ãŒè©¦ã›ã‚‹ZKã‚¢ãƒ—ãƒªã‚’å‹•ã‹ã—ã¦ã¿ãŸï¼"
emoji: "ğŸ› "
type: "tech"
topics: ["Web3", "Blockchain", "ã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜", "TypeScript", "zk"]
published: true
---

![](/images/mina-protocol_2/0.jpeg)

## ã¯ã˜ã‚ã«

çš†ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ã€‚

ä»Šå›ã¯ã€**MinaProtocol** ã¨ã„ã†ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸè¨˜äº‹ã‚’åŸ·ç­†ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ï¼

ç¾åœ¨ãƒãƒƒã‚«ã‚½ãƒ³ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **Akindo**ã¨**MinaProtocol**ã®ãƒãƒ¼ãƒ ãŒã‚¿ãƒƒã‚°çµ„ã‚“ã§ WaveHack ã¨ã„ã†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿæ–½ä¸­ã§ã™ï¼

https://app.akindo.io/wave-hacks/ENw9p7R6nUz818lo1

**WaveHack** ã£ã¦ãªã‚“ã ã¨ã„ã†æ–¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’ã”å‚ç…§ãã ã•ã„ï¼

ãƒ•ã‚¡ã‚¦ãƒ³ãƒ€ãƒ¼ã§ã‚ã‚‹é‡‘åŸã•ã‚“ã®æƒ³ã„ãŒã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ï¼ï¼ï¼

https://note.com/shinkinjo/n/n313d1e931ebf

## Mina Protocol ã¨ã¯

Mina Protocol ã¯ O(1)Labs ã«ã‚ˆã‚Š 2017 å¹´ 6 æœˆã‹ã‚‰é–‹ç™ºã•ã‚Œã¦ã„ã‚‹ L1 ã®ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚

https://minaprotocol.com/

**o1js** ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ **TypeScript** ã§ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ï¼

https://docs.minaprotocol.com/zkapps/o1js

ã¾ãŸã€ãŸã ã®ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã§ã¯ãªãã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜ã‚’ãƒ•ãƒ«æ´»ç”¨ã—ãŸ **ZK App**ã‚’é–‹ç™ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«ãªã£ã¦ã„ã¾ã™ï¼ï¼

## ä»Šå›ä½¿ã†ã‚³ãƒ¼ãƒ‰

ä»Šå›ä½¿ã†ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«æ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://github.com/mashharuki/mina-protocol-workshop-slides/tree/2024-devcon-main

Fork å…ƒã®ã‚³ãƒ¼ãƒ‰ã¯ **Devcon** æœŸé–“ä¸­ã«é–‹å‚¬ã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã®ã‚³ãƒ¼ãƒ‰ã§ã™ï¼

https://lu.ma/ua6yov8a?tk=9QSuVq

ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ ã¨ã—ã¦ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒç¶ºéº—ã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ã€‚

```bash
.
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ ui
â””â”€â”€ zk
```

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚¸ãƒƒã‚¯ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ ¼ç´ã—ã¦ã„ã‚‹ `zk` ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

ã“ã®å¾Œã®ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã§ã¯ã€ `ethSignatureProgram.ts`ã‚’ãƒ¡ã‚¤ãƒ³ã«è§£èª¬ã—ã¦ã„ãã¾ã™ï¼

```bash
.
â”œâ”€â”€ babel.config.cjs
â”œâ”€â”€ bun.lockb
â”œâ”€â”€ config.json
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ ethSignatureProgram.test.ts
â”‚   â””â”€â”€ ethSignatureProgram.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ vitest.config.ts
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ã® `ui`ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼

**Next.js**ã‚’ä½¿ã£ã¦æ§‹ç¯‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

```bash
.
â”œâ”€â”€ README.md
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ components
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ zkWorker.ts
â”‚   â””â”€â”€ zkWorkerClient.ts
â”œâ”€â”€ bun.lockb
â”œâ”€â”€ global.d.ts
â”œâ”€â”€ next.config.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ postcss.config.mjs
â”œâ”€â”€ public
â”‚   â””â”€â”€ assets
â”œâ”€â”€ styles
â”‚   â”œâ”€â”€ Home.module.css
â”‚   â””â”€â”€ globals.css
â”œâ”€â”€ tailwind.config.ts
â””â”€â”€ tsconfig.json
```

## ã‚³ãƒ¼ãƒ‰ã®è§£èª¬

ã§ã¯ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã«ã†ã¤ã‚Šã¾ã™ï¼

- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è§£èª¬**

  ã§ã¯ã¾ãšç½²åãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã™ã‚‹ ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®è§£èª¬ã‚’è¡Œã„ã¾ã™ï¼

  :::message
  **ethSignatureProgram.ts** ã®ä¸­èº«ã§ã™ã€‚
  :::

  æ™®é€šã® TypeScript ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãæ„Ÿã˜ã§ ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆã‚’å®Ÿè£…ã§ãã‚‹ç‚¹ãŒã€ MinaProtocol ã®æœ€å¤§ã®ãƒã‚¤ãƒ³ãƒˆã§ã™ã­ï¼

  ```ts
  import {
    Bool,
    Bytes,
    createEcdsa,
    createForeignCurve,
    Crypto,
    ZkProgram,
  } from "o1js";

  class Secp256k1 extends createForeignCurve(Crypto.CurveParams.Secp256k1) {}
  class ECDSA extends createEcdsa(Secp256k1) {}
  class Bytes32 extends Bytes(32) {}

  /**
   * ç½²åãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ZKå›è·¯
   */
  export const EthSignatureProgram = ZkProgram({
    name: "EthSignatureProgram",
    publicInput: Bytes32, // ã‚¤ãƒ³ãƒ—ãƒƒãƒˆ
    publicOutput: Bool, // ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆ
    methods: {
      // æ¤œè¨¼ç”¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã€‚ä½¿ç”¨ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãªã©ã‚’æŒ‡å®šã€‚
      // ä»Šå›ã¯ã€verifySignatureã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ã„ã‚‹ã€‚
      verifySignature: {
        privateInputs: [ECDSA, Secp256k1],
        async method(message: Bytes32, signature: ECDSA, publicKey: Secp256k1) {
          return {
            // æˆ»ã‚Šå€¤ã—ã¦ã€æ¤œè¨¼çµæœã®ã¿ã‚’è¿”ã™ã€‚
            publicOutput: signature.verifyEthers(message, publicKey),
          };
        },
      },
    },
  });
  ```

  ä»Šå›ã¯ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚‚ç”¨æ„ã•ã‚Œã¦ã„ã¾ã—ãŸï¼

  ```ts
  import { Wallet } from "ethers";
  import { Bytes, createEcdsa, createForeignCurve, Crypto } from "o1js";
  import { beforeAll, describe, expect, it } from "vitest";
  import { EthSignatureProgram } from "./ethSignatureProgram.js";

  class Secp256k1 extends createForeignCurve(Crypto.CurveParams.Secp256k1) {}
  class ECDSA extends createEcdsa(Secp256k1) {}
  class Bytes32 extends Bytes(32) {}

  /**
   * ZKå›è·¯ã‚’ä½¿ç”¨ã—ã¦ã€ç½²åãƒ‡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ãƒ†ã‚¹ãƒˆ
   */
  describe("EthSignatureProgram", () => {
    // Padding the messages to 32 bytes so that both signing libraries handle them the same
    const message = "Hello, world!".padEnd(32, "0");
    const spoofedMessage = "Goodbye, world!".padEnd(32, "0");

    // Convert ethereum public key to o1js Secp256k1 point
    const ethWallet = Wallet.createRandom();
    const compressedPublicKey = ethWallet.signingKey.compressedPublicKey;
    const publicKey = Secp256k1.fromEthers(compressedPublicKey);

    beforeAll(async () => {
      // ZKã‚µãƒ¼ã‚­ãƒƒãƒˆã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
      await EthSignatureProgram.compile();
    });

    it("should verify a valid signature", async () => {
      // ç½²åãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
      const ethSignature = await ethWallet.signMessage(message);
      // proofã‚’ä½œæˆ(å…ƒã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ç½²åãƒ‡ãƒ¼ã‚¿ã€å…¬é–‹éµã‚’ä½¿ã†ã€‚)
      const proof = (
        await EthSignatureProgram.verifySignature(
          Bytes32.fromString(message),
          ECDSA.fromHex(ethSignature),
          publicKey
        )
      ).proof;
      // å•é¡Œãªãæ¤œè¨¼ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
      expect(proof.publicOutput.toBoolean()).toBe(true);
    });
    it("should not verify an invalid signature", async () => {
      const ethSignature = await ethWallet.signMessage(message);
      // ç•°ãªã‚‹ç½²åãƒ‡ãƒ¼ã‚¿ã‚’ä¸ãˆã‚‹ã€‚(å…ƒã®ç½²åãƒ‡ãƒ¼ã‚¿ã‚’å¤‰ãˆã‚‹ã€‚)
      const proof = (
        await EthSignatureProgram.verifySignature(
          Bytes32.fromString(spoofedMessage),
          ECDSA.fromHex(ethSignature),
          publicKey
        )
      ).proof;
      //ç½²åãƒ‡ãƒ¼ã‚¿ãŒç•°ãªã‚‹ã®ã§æ¤œè¨¼ãŒå¤±æ•—ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚
      expect(proof.publicOutput.toBoolean()).toBe(false);
    });
  });
  ```

  ä»Šå›ã¯éå¸¸ã«ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ­ã‚¸ãƒƒã‚¯ã¨ãªã£ã¦ã„ã¾ã™ï¼

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è§£èª¬**

  ã§ã¯ã“ã“ã‹ã‚‰ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®è§£èª¬ã«ã†ã¤ã‚Šã¾ã™ï¼ï¼

  :::message
  ä»¥ä¸‹ã€3 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ï¼

  - **zkWorker.ts**
  - **zkWorkerClient.ts**
  - **page.tsx**
    :::

  - **zkWorker.ts** ã«ã¤ã„ã¦

    zkWorker.ts ã«ã¯ã€ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆã®æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã™ãƒ­ã‚¸ãƒƒã‚¯ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ï¼

    ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ç´¹ä»‹ã—ãŸ ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å®Ÿè£…ãªã©ãŒã‚ã‚Šã¾ã™ã€‚

    ãã—ã¦ä»Šå›ã®ã‚­ãƒ¢ã¨ãªã‚‹ æ¤œè¨¼ç”¨ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ API ã‚‚å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

    ```ts
    import * as Comlink from "comlink";
    import { Bytes, Crypto, Mina, createEcdsa, createForeignCurve } from "o1js";
    import type { EthSignatureProgram } from "../../zk/build/src/ethSignatureProgram.js";

    const state = {
      zkProgram: null as null | typeof EthSignatureProgram,
    };

    class Secp256k1 extends createForeignCurve(Crypto.CurveParams.Secp256k1) {}
    class ECDSA extends createEcdsa(Secp256k1) {}
    class Bytes32 extends Bytes(32) {}

    /**
     * ZKå›è·¯æ“ä½œé–¢é€£ã®API
     */
    export const api = {
      /**
       * ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Minaã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’Devnetã«è¨­å®šã—ã¾ã™ã€‚
       */
      async setActiveInstanceToDevnet() {
        const Network = Mina.Network(
          "https://api.minascan.io/node/devnet/v1/graphql"
        );
        console.log("Devnet network instance configured");
        Mina.setActiveInstance(Network);
      },
      /**
       * ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
       */
      async loadProgram() {
        const { EthSignatureProgram } = await import(
          "../../zk/build/src/ethSignatureProgram.js"
        );
        state.zkProgram = EthSignatureProgram;
      },
      /**
       * ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¾ã™ã€‚
       */
      async compileProgram() {
        await state.zkProgram!.compile();
      },
      /**
       * ç½²åã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰
       * @param message
       * @param ethSignature
       * @param ethPublicKey
       * @returns
       */
      async verifySignature(
        message: string,
        ethSignature: string,
        ethPublicKey: string
      ) {
        const messageBytes = Bytes32.fromString(message);
        const signature = ECDSA.fromHex(ethSignature);
        const publicKey = Secp256k1.fromEthers(ethPublicKey);
        // æ¤œè¨¼
        const result = await state.zkProgram!.verifySignature(
          messageBytes,
          signature,
          publicKey
        );
        // æ¤œè¨¼çµæœã‚’å–å¾—
        const valid = result.proof.publicOutput.toBoolean();
        if (!valid) {
          console.error("Invalid signature");
          return {
            valid: false,
            proof: result.proof.toJSON(),
          };
        }

        return {
          valid: true,
          proof: result.proof.toJSON(),
        };
      },
    };

    // Expose the API to be used by the main thread
    Comlink.expose(api);
    ```

  - **zkWorkerClient.ts** ã«ã¤ã„ã¦

    ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ä¸€ã¤å‰ã«ç´¹ä»‹ã—ãŸ ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆå‘¨ã‚Šã®æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã™ API ã‚’æ‰±ã†ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã‚’å®šç¾©ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

    ã“ã“ã§å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦ `page.tsx`ã§åˆ©ç”¨ã—ã¦ã„ã¾ã™ï¼

    ```ts
    import * as Comlink from "comlink";

    /**
     * ZkWorkerCllient Class
     */
    export default class ZkWorkerCllient {
      // ---------------------------------------------------------------------------------------
      worker: Worker;
      // Proxy to interact with the worker's methods as if they were local
      remoteApi: Comlink.Remote<typeof import("./zkWorker").api>;

      constructor() {
        // Initialize the worker from the zkappWorker module
        const worker = new Worker(new URL("./zkWorker.ts", import.meta.url), {
          type: "module",
        });
        this.worker = worker;
        // Wrap the worker with Comlink to enable direct method invocation
        this.remoteApi = Comlink.wrap(worker);
      }

      async loadProgram() {
        return this.remoteApi.loadProgram();
      }

      async compileProgram() {
        return this.remoteApi.compileProgram();
      }

      async verifySignature(
        message: string,
        ethSignature: string,
        ethPublicKey: string
      ) {
        console.log("Verifying signature...");
        console.log("Message: ", message);
        console.log("Signature: ", ethSignature);
        console.log("Public key: ", ethPublicKey);
        return this.remoteApi.verifySignature(
          message,
          ethSignature,
          ethPublicKey
        );
      }
    }
    ```

    ã“ã“ã§æ¥ãŸã‚‰ã„ã‚ˆã„ã‚ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰å‘¼ã³å‡ºã™æº–å‚™ãŒæ•´ã„ã¾ã—ãŸï¼

  - **page.tsx** ã«ã¤ã„ã¦

    ä¸€ã¤å‰ã«ç´¹ä»‹ã—ãŸ`ZkWorkerCllient`ã‚¯ãƒ©ã‚¹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã—ã¦æ¤œè¨¼ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼

    ãã—ã¦ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ™‚ã« ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆç”¨ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰ï¼†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼

    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç½²åã¯ `ethers.js`ã§æä¾›ã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

    ```ts
    "use client";
    import { ethers, SigningKey } from "ethers";
    import Head from "next/head";
    import Image from "next/image";
    import { JsonProof } from "o1js";
    import { useEffect, useState } from "react";
    import heroMinaLogo from "./../public/assets/hero-mina-logo.svg";
    import styles from "./../styles/Home.module.css";
    import GradientBG from "./components/GradientBG.js";
    import ZkWorkerClient from "./zkWorkerClient";

    /**
     * home component
     * @returns
     */
    export default function Home() {
      const [zkWorkerClient] = useState(new ZkWorkerClient());
      const [hasBeenCompiled, sethasBeenCompiled] = useState(false);
      const [isVerifying, setIsVerifying] = useState(false);
      const [isVerified, setIsVerified] = useState<boolean | null>(null);
      const [proof, setProof] = useState<JsonProof | null>(null);

      const [connected, setConnected] = useState(false);
      const [ethWalletAddress, setEthAddress] = useState("");
      const [ethSigner, setEthSigner] = useState<ethers.JsonRpcSigner | null>(
        null
      );

      const [message, setMessage] = useState("");
      const [ethSignature, setEthSignature] = useState("");

      function shortenString(str: string) {
        return `${str.slice(0, 20)}...${str.slice(-6)}`;
      }

      /**
       * Function to connect/disconnect the wallet
       */
      async function connectEthWallet() {
        if (!connected) {
          // Connect the wallet using ethers.js
          const provider = new ethers.BrowserProvider(window.ethereum);
          const signer = await provider.getSigner();
          const address = await signer.getAddress();

          setConnected(true);
          setEthAddress(address);
          setEthSigner(signer);
        } else {
          // Disconnect the wallet
          window.ethereum.selectedAddress = null;
          setConnected(false);
          setEthAddress("");
          setEthSigner(null);
        }
      }

      /**
       * ç½²åãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å…¬é–‹éµã‚’å–å¾—ã™ã‚‹ã€‚
       * @returns
       */
      async function getPublicKeyFromSignature() {
        const address = ethWalletAddress;
        console.log("Wallet Address:", address);

        // Hash the message (to match Ethereum's signing behavior)
        const paddedMessage = message.padEnd(32, "0");
        const messageHash = ethers.hashMessage(paddedMessage);
        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒƒã‚·ãƒ¥ã¨ç½²åãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å…¬é–‹éµã‚’å¾©å…ƒã™ã‚‹ã€‚
        const ethPublicKey = SigningKey.recoverPublicKey(
          messageHash,
          ethSignature
        );
        const compressedPublicKey = SigningKey.computePublicKey(
          ethPublicKey,
          true
        );

        // The public key is in uncompressed form (starts with "04" prefix)
        console.log("Recovered Public Key:", compressedPublicKey);
        return compressedPublicKey;
        // return ethWallet.signingKey.compressedPublicKey;
      }

      /**
       * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ç½²åãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹ã€‚
       * @param message
       * @returns
       */
      async function signMessageEthers(message: string) {
        const paddedMessage = message.padEnd(32, "0");
        const provider = new ethers.BrowserProvider(window.ethereum);
        const signer = await provider.getSigner();
        // ç½²åãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹ã€‚
        const ethSignature = await signer.signMessage(paddedMessage);
        console.log("signing message with ethers.js");
        console.log("message:", paddedMessage);
        setEthSignature(ethSignature);
        return ethSignature;
      }

      /**
       * ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¸¡ã—ã¦æ¤œè¨¼ã™ã‚‹ã€‚
       * @param message
       * @returns
       */
      async function verifyMessageMina(message: string) {
        const paddedMessage = message.padEnd(32, "0");
        // ç½²åãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å…¬é–‹éµã‚’å–å¾—ã™ã‚‹ã€‚
        const ethPublicKey = await getPublicKeyFromSignature();
        // æ¤œè¨¼ã™ã‚‹ã€‚
        const result = await zkWorkerClient.verifySignature(
          paddedMessage,
          ethSignature,
          ethPublicKey
        );
        return result;
      }

      useEffect(() => {
        (async () => {
          console.log("compiling...");
          // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹
          await zkWorkerClient.loadProgram();
          await zkWorkerClient.compileProgram();
          console.log("compiled!");

          sethasBeenCompiled(true);
        })();
      }, [zkWorkerClient, sethasBeenCompiled]);

      return (
        <>
          <Head>
            <title>Eth to Mina Signature Verification Example</title>
            <meta name="description" content="built with o1js" />
            <link rel="icon" href="/assets/favicon.ico" />
          </Head>
          <GradientBG>
            <main className={styles.main}>
              <div className={styles.center}>
                <a
                  href="https://minaprotocol.com/"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <Image
                    className={styles.logo}
                    src={heroMinaLogo}
                    alt="Mina Logo"
                    width="191"
                    height="174"
                    priority
                  />
                </a>
                <p className={styles.tagline}>
                  built with &nbsp;
                  <code className="font-weight-bold">o1js</code>
                </p>
                <div className="pt-10">
                  <p className="text-black text-shadow-white text-2xl">
                    Eth to Mina Signature Verification Example
                  </p>
                  <div>
                    <button
                      className="mt-4 mb-4 w-full text-lg text-white font-bold rounded-lg p-2 bg-gradient-to-r from-blue-500 to-blue-700 hover:from-blue-700 hover:to-blue-900"
                      onClick={connectEthWallet}
                    >
                      {connected
                        ? "Disconnect Eth Wallet"
                        : "Connect Eth Wallet"}
                    </button>
                  </div>
                  {connected && (
                    <div className="p-4 bg-gray-100 rounded-lg shadow-md mb-10">
                      <p className="mb-4 text-lg font-semibold text-gray-700">
                        Connected eth wallet address: {ethWalletAddress}
                      </p>
                      <div className="flex flex-col space-y-4">
                        <input
                          id="message"
                          type="text"
                          placeholder="Message to sign"
                          value={message}
                          onChange={(e) => setMessage(e.target.value)}
                          className="p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                        <button
                          className="mt-4 mb-4 w-full text-lg text-white font-bold rounded-lg p-2 bg-gradient-to-r from-blue-500 to-blue-700 hover:from-blue-700 hover:to-blue-900"
                          onClick={async () => {
                            const ethSignature = await signMessageEthers(
                              message
                            );
                            console.log(ethSignature);
                          }}
                        >
                          Sign Message Ethers
                        </button>
                      </div>
                    </div>
                  )}
                  {!!ethSignature && (
                    <div className="p-4 bg-gray-100 rounded-lg shadow-md">
                      {!hasBeenCompiled && (
                        <div>
                          <p className="mb-4 text-lg font-semibold text-gray-700">
                            Compiling zkProgram...
                          </p>
                        </div>
                      )}
                      {hasBeenCompiled && (
                        <div>
                          <p className="mb-4 text-lg font-semibold text-gray-700">
                            Signature: {shortenString(ethSignature)}
                          </p>
                          <p className="mb-4 text-lg font-semibold text-gray-700">
                            Public Key: {ethWalletAddress}
                          </p>
                          <p className="mb-4 text-lg font-semibold text-gray-700">
                            Message: {message}
                          </p>
                          <button
                            className="mt-4 mb-4 w-full text-lg text-white font-bold rounded-lg p-2 bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-700 hover:to-purple-900"
                            onClick={async () => {
                              if (hasBeenCompiled) {
                                setIsVerifying(true);
                                const result = await verifyMessageMina(message);
                                console.log(result);
                                setIsVerified(result.valid);
                                setProof(result.proof);
                                setIsVerifying(false);
                              } else {
                                console.log("zkProgram not compiled yet");
                              }
                            }}
                          >
                            Verify Signature o1js
                          </button>
                          {isVerifying && (
                            <div>
                              <p className="mb-4 text-lg font-semibold text-gray-700">
                                Verifying signature...
                              </p>
                            </div>
                          )}
                          {!isVerifying && isVerified !== null && (
                            <div className="overflow-scroll max-w-xl">
                              <p className="mb-4 text-lg font-semibold text-gray-700">
                                Verification:{" "}
                                {isVerified ? "Success" : "Failed"}
                              </p>
                              <p className="mb-4 text-lg font-semibold text-gray-700">
                                Public Output:
                              </p>
                              <pre className="bg-gray-200 p-4 rounded-lg max-w-3/4 mx-auto whitespace-pre-wrap break-words">
                                {proof?.publicOutput || ""}
                              </pre>
                              <p className="mb-4 text-lg font-semibold text-gray-700">
                                Public Input:
                              </p>
                              <pre className="bg-gray-200 p-4 rounded-lg max-w-3/4 mx-auto whitespace-pre-wrap break-words">
                                {proof?.publicInput || ""}
                              </pre>
                              <p className="mb-4 text-lg font-semibold text-gray-700">
                                Proof:
                              </p>
                              <pre className="bg-gray-200 p-4 rounded-lg max-w-3/4 mx-auto whitespace-pre-wrap break-words">
                                {proof?.proof || ""}
                              </pre>
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  )}
                </div>
              </div>
            </main>
          </GradientBG>
        </>
      );
    }
    ```

    é•·ã‹ã£ãŸã§ã™ãŒã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…ã¯ä»¥ä¸Šã«ãªã‚Šã¾ã™ï¼

## å‹•ã‹ã—æ–¹

ã“ã“ã‹ã‚‰ã¯ç´¹ä»‹ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã™å…·ä½“çš„ãªæ–¹æ³•ã‚’è§£èª¬ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ï¼ï¼

- **å‹•ã‹ã—æ–¹(ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆå´)**

  - ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

    ```bash
    cd zk && bun install
    ```

  - ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆã®ãƒ†ã‚¹ãƒˆ

    ```bash
    bun run test
    ```

  - ZK ã‚µãƒ¼ã‚­ãƒƒãƒˆã®ãƒ“ãƒ«ãƒ‰

    ```bash
    bun run build
    ```

- **å‹•ã‹ã—æ–¹(ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)**

  - ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

    ```bash
    cd ui && bun install
    ```

  - ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®èµ·å‹•æ–¹æ³•

    ```bash
    bun run dev
    ```

    å•é¡Œãªã‘ã‚Œã°ã€ localhost:3000 ã§ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼ï¼

    ![](/images/mina-protocol_2/0_2.jpg)

    ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’æ¥ç¶šã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ï¼

    ![](/images/mina-protocol_2/1.png)

    é©å½“ã«ç½²åç”¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨˜å…¥ã—ã¦ç½²åã—ã¦ã—ã¾ã„ã¾ã—ã‚‡ã†ï¼

    ![](/images/mina-protocol_2/2.png)

    ç½²åã«ã¯ã—ã°ã‚‰ãæ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ï¼

    ![](/images/mina-protocol_2/3.png)

    ç½²åãŒå•é¡Œãªãçµ‚ã‚ã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ãªè¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ï¼

    ![](/images/mina-protocol_2/4.jpg)

    **Verify Signature O1js** ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æ¤œè¨¼ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼ï¼

    æ¤œè¨¼ã«ã‚‚æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ãŒã€å•é¡Œãªã‘ã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ã« **Success** ã¨è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ï¼ï¼ï¼

    ![](/images/mina-protocol_2/5.png)

é•·ã‹ã£ãŸã§ã™ãŒã€å‹•ã‹ã—æ–¹ã«ã¤ã„ã¦ã®è§£èª¬ã¯ã“ã“ã¾ã§ã«ãªã‚Šã¾ã™ï¼

## ã‚‚ã£ã¨ MinaProtocol ã‚’å­¦ã³ãŸã„äººã¯ãƒ»ãƒ»ãƒ»

ã“ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã‚‚ã£ã¨ MinaProtocol ã‚’å‹‰å¼·ã—ãŸã„ã¨æ€ã£ãŸäººã¯ä»¥ä¸‹ã® Youtube ãŒå‚è€ƒã«ãªã‚Šã¾ã™ï¼

https://www.youtube.com/watch?v=LLule5GUkkg&t=4116s

https://www.youtube.com/watch?v=hEHxBJNWkJo

https://www.youtube.com/live/_sklhKIPobM

## å‚è€ƒæ–‡çŒ®

ä»Šå›ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ä¸Šã§å‚è€ƒã«ãªã£ãŸæ–‡çŒ®ã®ãƒªãƒ³ã‚¯ã‚’å…±æœ‰ã—ã¾ã™ï¼

1. [writing-a-zkapp](https://docs.minaprotocol.com/zkapps/writing-a-zkapp)
2. [zkapp-development-frameworks](https://docs.minaprotocol.com/zkapps/zkapp-development-frameworks)
3. [GitHub - mina-fungible-token](https://github.com/MinaFoundation/mina-fungible-token)
4. [Mina Fungible Token Documentation](https://minafoundation.github.io/mina-fungible-token/deploy.html)
5. [examples/zkapps/](https://github.com/o1-labs/docs2/tree/main/examples/zkapps/)
6. [Mina Foundation Online Workshop for Building ZKApps with o1js](https://www.youtube.com/watch?v=LLule5GUkkg&t=4116s)
7. [ä½œæˆã—ãŸé–‹ç™ºç”¨ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ](https://minascan.io/devnet/tx/5JuPC4hhNb83ufKmuRtj97jSSbdDURLTwTb6vmJL6k3Bv7Zi6uA7)
8. [ãƒ•ã‚¡ã‚¦ã‚»ãƒƒãƒˆç”¨ãƒªãƒ³ã‚¯](https://faucet.minaprotocol.com/?address=B62qoFHxcia11kauLdy6f9B8yfB9QUkMRDTJhrXoKEgkuDzDSGU9MgU&explorer=minascan)
9. [mina-fungible-token Docs](https://minafoundation.github.io/mina-fungible-token/)
10. [interacting-with-zkapps-server-side](https://docs.minaprotocol.com/zkapps/tutorials/interacting-with-zkapps-server-side)
11. [Tutorial 4: Build a zkApp UI in the Browser with React](https://docs.minaprotocol.com/zkapps/tutorials/zkapp-ui-with-react)
12. [GitHub - o1-labs-XT/workshop-slides](https://github.com/o1-labs-XT/workshop-slides/tree/main)
