---
title: "Reownã‚’ä½¿ã£ã¦Web3ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ãŸï¼"
emoji: "ğŸ¤–"
type: "tech"
topics: ["Solana", "Web3", "TypeScript", "ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³", "ç”ŸæˆAI"]
published: false
---

![](/images/reown_solana_dapp/title.png)

## ğŸš€ ã¯ã˜ã‚ã«

**Breakout** ã¨ã„ã† Solana ãƒãƒƒã‚«ã‚½ãƒ³ã§ã€Reown ã® SDK ã‚’ä½¿ã£ã¦ Web3 ã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã¦ã¿ã¾ã—ãŸï¼

https://www.colosseum.org/breakout

**ã€ŒSolana ã¨ã©ã†ã¤ãªãã®ï¼Ÿã€** **ã€Œã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆæ©Ÿèƒ½ã‚’ã©ã†å‘¼ã³å‡ºã™ã®ï¼Ÿã€** ã¨ã„ã£ãŸç–‘å•ã‚’ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ä»˜ãã§å¾¹åº•è§£èª¬ã—ã¾ã™ã€‚

åˆå¿ƒè€…ã‹ã‚‰ä¸­ç´šè€…ã¾ã§ä½¿ãˆã‚‹ãƒã‚¦ãƒã‚¦æº€è¼‰ã€æœ€é€Ÿã§å‹•ããƒ‡ãƒ¢ã‚‚ã”ç”¨æ„ã—ã¾ã—ãŸã®ã§ã€ãœã²æœ€å¾Œã¾ã§ã”è¦§ãã ã•ã„ï¼

## ğŸ’¡ Reown SDK ã¨ã¯ï¼Ÿ

**Reown** ã¯ **WalletConnect** ã‚’ãƒªãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã—ãŸã‚‚ã®ã§ã™ã€‚

https://reown.com/

**Reown SDK** ã¯ã€

- Solana ã‚„ EVM ç³»ãªã©ãƒãƒ«ãƒãƒã‚§ãƒ¼ãƒ³ã«å¯¾å¿œã—ãŸã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã‚‹ SDK ã§ã™
- **Anchor** ã‚„ **viem** ãªã©ã® SDK ã¨çµ„ã¿ã‚ã›ã¦ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®å‘¼ã³å‡ºã—ï¼†æ›¸ãè¾¼ã¿å‡¦ç†ãŒå¯èƒ½ã§ã™ï¼
- TypeScript/JavaScript å¯¾å¿œ

ãªã© Web3 ã‚¢ãƒ—ãƒªé–‹ç™ºã«å¿…è¦ãªæ©Ÿèƒ½ã‚’ãƒ¯ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§æä¾›ã—ã¦ãã‚Œã‚‹ã‚¦ã‚©ãƒ¬ãƒƒãƒˆç³»ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã‚‚å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ï¼ï¼

**EVM ç³»ã ã‘ã§ã¯ãªã Solana ãªã©ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ä»®æƒ³ãƒã‚·ãƒ³ãŒç•°ãªã‚‹è¤‡æ•°ã®ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«å¯¾å¿œã—ã¦ã„ã‚‹ç‚¹ãŒå¤§ããªç‰¹å¾´** ã§ã™ï¼

https://demo.reown.com/?config=eyJmZWF0dXJlcyI6eyJyZWNlaXZlIjp0cnVlLCJzZW5kIjp0cnVlLCJlbWFpbFNob3dXYWxsZXRzIjp0cnVlLCJjb25uZWN0b3JUeXBlT3JkZXIiOlsid2FsbGV0Q29ubmVjdCIsInJlY2VudCIsImluamVjdGVkIiwiZmVhdHVyZWQiLCJjdXN0b20iLCJleHRlcm5hbCIsInJlY29tbWVuZGVkIl0sImFuYWx5dGljcyI6dHJ1ZSwiYWxsV2FsbGV0cyI6dHJ1ZSwibGVnYWxDaGVja2JveCI6ZmFsc2UsInNtYXJ0U2Vzc2lvbnMiOmZhbHNlLCJjb2xsYXBzZVdhbGxldHMiOmZhbHNlLCJ3YWxsZXRGZWF0dXJlc09yZGVyIjpbIm9ucmFtcCIsInN3YXBzIiwicmVjZWl2ZSIsInNlbmQiXSwiY29ubmVjdE1ldGhvZHNPcmRlciI6WyJlbWFpbCIsInNvY2lhbCIsIndhbGxldCJdLCJwYXkiOmZhbHNlfSwidGhlbWVWYXJpYWJsZXMiOnt9LCJyZW1vdGVGZWF0dXJlcyI6eyJzd2FwcyI6WyIxaW5jaCJdLCJvbnJhbXAiOlsiY29pbmJhc2UiLCJtZWxkIl0sImVtYWlsIjp0cnVlLCJzb2NpYWxzIjpbImdvb2dsZSIsIngiLCJmYXJjYXN0ZXIiLCJkaXNjb3JkIiwiYXBwbGUiLCJnaXRodWIiLCJmYWNlYm9vayJdLCJhY3Rpdml0eSI6dHJ1ZSwicmVvd25CcmFuZGluZyI6dHJ1ZX19

## Reown SDK ã®å°å…¥æ–¹æ³•

å°å…¥æ–¹æ³•ã¯ä»¥ä¸‹ã® 3 ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ï¼ï¼ï¼

### 1. API ã‚­ãƒ¼ã®ç™ºè¡Œ

ã¾ãšãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ API ã‚­ãƒ¼ã‚’ç™ºè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ï¼

https://cloud.reown.com

### 2. ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

æ¬¡ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä¸€å¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
npm install @reown/appkit @coral-xyz/anchor @reown/appkit-adapter-solana @solana/wallet-adapter-react @solana/web3.js
```

### 3. appkit-button ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åŸ‹ã‚è¾¼ã¿

ã“ã“ã¾ã§ããŸã‚‰å¿…è¦ãªè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¦ã€ `<appkit-button>` ã‚’åŸ‹ã‚è¾¼ã‚ã°æº–å‚™ OK ã§ã™ï¼

- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«(config.ts)ã®å®Ÿè£…

  ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿ã‚„å¯¾å¿œã™ã‚‹ãƒã‚§ãƒ¼ãƒ³ã®ç¨®é¡ãªã©ã‚’å®šç¾©ã—ã¾ã™ã€‚

  ä»Šå›ã¯ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆã€ãƒ†ã‚¹ãƒˆãƒãƒƒãƒˆã€Dev ãƒãƒƒãƒˆã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

  ```ts
  import { SolanaAdapter } from "@reown/appkit-adapter-solana/react";
  import type { AppKitNetwork } from "@reown/appkit/networks";

  // Get projectId from https://cloud.reown.com
  export const projectId =
    process.env.NEXT_PUBLIC_PROJECT_ID || "b56e18d47c72ab683b10814fe9495694";

  if (!projectId) {
    throw new Error("Project ID is not defined");
  }

  // solana mainnet, testnet, and devnet
  export const networks = [solana, solanaTestnet, solanaDevnet] as [
    AppKitNetwork,
    ...AppKitNetwork[]
  ];

  // Set up Solana Adapter
  export const solanaWeb3JsAdapter = new SolanaAdapter();
  ```

- `createAppKit` ã§ AppKit ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆ

  ä¸Šè¨˜è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ **AppKit** ã‚’ç”Ÿæˆã•ã›ã¾ã™ã€‚

  ä¸‹è¨˜ã¯å®Ÿè£…ä¾‹ã§ã™ã€‚

  ```ts
  "use client";

  import { networks, projectId, solanaWeb3JsAdapter } from "@/config";
  import { createAppKit } from "@reown/appkit";
  import { ConnectionProvider } from "@solana/wallet-adapter-react";
  import { clusterApiUrl } from "@solana/web3.js";
  import { createContext, useEffect, useState, type ReactNode } from "react";

  // Set up metadata
  const metadata = {
    name: "oto",
    description: "oto",
    url: "https://github.com/Heterod0x/oto", // origin must match your domain & subdomain
    icons: ["https://avatars.githubusercontent.com/u/179229932"],
  };

  const solanaEndpoint = clusterApiUrl("devnet");

  // Create the modal
  export const modal = createAppKit({
    adapters: [solanaWeb3JsAdapter], // ã“ã“ã§ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’æŒ‡å®š
    projectId, // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIdã‚’æŒ‡å®š
    networks, // å¯¾å¿œã™ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã‚’æŒ‡å®š
    metadata,
    themeMode: "light",
    features: {
      analytics: true, // Optional - defaults to your Cloud configuration
    },
    themeVariables: {
      "--w3m-accent": "#000000",
    },
  });

  // Create context
  export const WalletContext = createContext<WalletContextType>(defaultContext);

  // Provider component
  export function WalletProvider({ children }: { children: ReactNode }) {
    return (
      <ConnectionProvider endpoint={solanaEndpoint}>
        <WalletContext.Provider>{children}</WalletContext.Provider>
      </ConnectionProvider>
    );
  }
  ```

  ãã—ãŸã‚‰ä»»æ„ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«åŸ‹ã‚è¾¼ã‚“ã§ã‚ã’ã‚‹ã ã‘ã§ã™ï¼ï¼

  <br/>

  `<appkit-button />` ã§ã™ã­ï¼

  <br/>

  ã“ã‚Œã‚’åŸ‹ã‚è¾¼ã‚“ã§ã‚ã’ã‚‹ã ã‘ã§ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ¥ç¶šã‚„ã‚¢ãƒ‰ãƒ¬ã‚¹ã® QR ã‚³ãƒ¼ãƒ‰ã€æ®‹é«˜è¡¨ç¤ºãªã©æœ€ä½é™å¿…è¦ãªæ©Ÿèƒ½ãŒç°¡å˜ã«å®Ÿè£…ã§ãã¦ã—ã¾ã„ã¾ã™ï¼ï¼ï¼

  ```ts
  "use client";

  import { useAppKitAccount } from "@reown/appkit/react";
  import { useRouter } from "next/navigation";
  import { useEffect } from "react";

  /**
   * Home Component
   */
  export default function Home() {
    const { address: walletAddress } = useAppKitAccount();
    const router = useRouter();

    useEffect(() => {
      if (walletAddress) {
        router.push("/record");
      }
    }, [walletAddress, router]);

    return (
      <div className="container flex flex-col items-center justify-center min-h-screen py-12 space-y-8">
        <div className="text-center">
          <h1 className="text-4xl font-bold mb-2">Welcome to Oto</h1>
          <p className="text-xl text-muted-foreground">
            Connect your wallet to get started
          </p>
        </div>

        {walletAddress ? null : (
          <div className="flex flex-col items-center">
            {/* ã“ã‚ŒãŒ Reown SDKãŒæä¾›ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ */}
            <appkit-button />
          </div>
        )}
      </div>
    );
  }
  ```

## ğŸ›  ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å‘¼ã³å‡ºã™æ–¹æ³•

ä»Šå›ã¯ **Solana** ä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®æ©Ÿèƒ½ã‚’å‘¼ã³å‡ºã™æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ï¼

**reown** ã®ç‰¹å¾´ã¯ **Solana** ã¨ **EVM** ç³»ã®ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ä¸¡æ–¹ã«å¯¾å¿œã—ã¦ã„ã‚‹ç‚¹ã§ã™ï¼

ã•ã™ãŒã«ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’å‘¼ã³å‡ºã™éƒ¨åˆ†ã ã‘ã¯æ›¸ãæ›ãˆã‚‹å¿…è¦ãŒå‡ºã¦ãã¾ã™ãŒã€å¤§å…ƒã®ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã® SDK ã‚’ã„ã¡ã„ã¡å¤‰ãˆã‚‹å¿…è¦ãŒãªã„ã¨ã“ã‚ãŒè‰¯ã„ã§ã™ã­ã€‚

hooks ã¨ã—ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚

æ›¸ãè¾¼ã¿ç³»ãƒ»èª­ã¿è¾¼ã¿ç³»ã®ãƒ¡ã‚½ãƒƒãƒ‰ä¸¡æ–¹ã¨ã‚‚å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼

```typescript
"use client";

import { BN, Program } from "@coral-xyz/anchor";
import { useAppKitAccount, useAppKitProvider } from "@reown/appkit/react";
import {
  ASSOCIATED_TOKEN_PROGRAM_ID,
  TOKEN_PROGRAM_ID,
} from "@solana/spl-token";
import { PublicKey, SYSVAR_RENT_PUBKEY } from "@solana/web3.js";
import { useMutation, useQuery } from "@tanstack/react-query";
import { useEffect, useMemo, useState } from "react";

import { Oto } from "@/contracts/oto";
import otoIdl from "@/contracts/oto.json";
import { useAnchorProvider } from "./useAnchorProvider";

// Constants
const OTO_SEED = "oto";
const USER_SEED = "user";
const MINT_SEED = "mint";

/**
 * Custom hook to communicate with the Oto contract
 * @returns Functions and data for contract operations
 */
export const useContract = () => {
  const [otoPDA, setOtoPDA] = useState<string | null>(null);
  const [userPDA, setUserPDA] = useState<string | null>(null);
  const [mintPDA, setMintPDA] = useState<string | null>(null);

  const { address } = useAppKitAccount();
  // Solanaã®å ´åˆã¯ "solana" ã‚’å¼•æ•°ã«æŒ‡å®šã™ã‚‹ã€‚
  // EVMã®å ´åˆã¯ã€ "eip155"ã‚’å¼•æ•°ã«æŒ‡å®šã™ã‚‹
  const { walletProvider } = useAppKitProvider<any>("solana");
  // Anchor SDKã® useAnchorProviderã‚’ä½¿ã„ã¾ã™ã€‚
  const { provider, cluster } = useAnchorProvider();

  // ä»Šå›ä½¿ã†ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ID
  const programId = useMemo(() => {
    try {
      return new PublicKey(otoIdl.address);
    } catch (error) {
      console.error("Failed to create PublicKey:", error);
      return null;
    }
  }, []);

  // Otoã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ç”Ÿæˆ
  const program = useMemo(() => {
    try {
      if (!provider || !programId) return null;
      // Create Program class correctly
      return new Program<Oto>(otoIdl as any, provider);
    } catch (error) {
      console.error("Failed to create Program instance:", error);
      return null;
    }
  }, [provider, programId]);

  // Calculation of PDAs
  useEffect(() => {
    /**
     * calculatePDAs method
     * @returns
     */
    const calculatePDAs = async () => {
      if (!program || !programId) return;

      console.log("Program ID:", programId.toBase58());

      // Oto PDA - correct seeds based on IDL definition
      const [oto] = PublicKey.findProgramAddressSync(
        [Buffer.from(OTO_SEED)],
        programId
      );
      setOtoPDA(oto.toBase58());
      console.log("Oto PDA:", oto.toBase58());

      // Mint PDA - correct seeds based on IDL definition
      const [mint] = PublicKey.findProgramAddressSync(
        [Buffer.from(MINT_SEED)],
        programId
      );
      setMintPDA(mint.toBase58());
      console.log("Mint PDA:", mint.toBase58());
    };

    calculatePDAs();
  }, [program, programId]);

  const getUserId = (address: string) => {
    return address.substring(0, 8);
  };

  /**
   * Calculate PDA for a specific user
   * @param userId
   * @returns
   */
  const getUserPDA = async (userId: string) => {
    if (!programId) return null;
    console.log("Program ID:", programId.toBase58());
    console.log("User ID:", userId);

    // If user ID is too long, use only the first 8 characters
    // Or, if using the wallet address, limit to a certain length
    const shortenedUserId = getUserId(userId);
    console.log("Shortened User ID:", shortenedUserId);

    // PDA - generate correct PDA using USER_SEED and userId
    const [userPDA] = PublicKey.findProgramAddressSync(
      [Buffer.from(USER_SEED), Buffer.from(shortenedUserId)],
      programId
    );
    return userPDA.toBase58();
  };

  /**
   * get User Account PDA
   * @param userId
   * @returns
   */
  const getUserAccount = async (userId: string) => {
    if (!program || !programId) return null;

    try {
      // call getUserPDA to get correct user PDA
      const userAddress = await getUserPDA(userId);
      console.log("User Address:", userAddress);
      if (!userAddress) return null;

      const userPDA = new PublicKey(userAddress);
      console.log("userPDA", userPDA.toBase58());

      // call fetch method with the correct PDA
      return await program.account.user.fetch(userPDA);
    } catch (error: any) {
      // Identify cases where the account does not exist
      if (
        error.message?.includes("Account does not exist") ||
        error.message?.includes("account not found") ||
        error.message?.includes("Program failed to complete")
      ) {
        console.log("User account does not exist:", userId);

        if (!program || !address || !otoPDA || !mintPDA)
          throw new Error("Not initialized");
      }

      return null;
    }
  };

  /**
   * Mutation to initialize a user
   */
  const initializeUser = useMutation({
    mutationKey: ["oto", "initializeUser", { cluster }],
    mutationFn: async ({
      userId,
      owner,
    }: {
      userId: string;
      owner?: string;
    }) => {
      // ä»¥å¾Œã€å®Ÿéš›ã®å‡¦ç†
      if (!program || !address || !otoPDA) throw new Error("Not initialized");

      const shortenedUserId = getUserId(userId);

      // Use the specified owner or the current connected address
      const ownerKey = owner ? new PublicKey(owner) : new PublicKey(address);

      // Calculate the user's PDA
      const calculatedUserPDA = await getUserPDA(userId);
      if (!calculatedUserPDA) throw new Error("Failed to calculate user PDA");

      console.log("User PDA to initialize:", calculatedUserPDA);
      console.log("Oto PDA:", otoPDA);
      console.log("Payer:", address);

      // Correctly specify the required accounts based on the IDL
      try {
        // Userã®åˆæœŸåŒ–
        const sig = await program.methods
          .initializeUser(shortenedUserId, ownerKey)
          .accounts({
            payer: new PublicKey(address),
          })
          .rpc();
        console.log(sig);
      } catch (error) {
        console.error("Failed to initialize user account:", error);
      }
    },
  });

  /**
   * Mutation to initialize the Oto program
   */
  const initializeOto = useMutation({
    mutationKey: ["oto", "initializeOto", { cluster }],
    mutationFn: async ({ nftCollection }: { nftCollection: PublicKey }) => {
      if (!program || !address || !programId)
        throw new Error("Not initialized");

      // Calculate PDAs
      const [otoPDA] = PublicKey.findProgramAddressSync(
        [Buffer.from(OTO_SEED)],
        programId
      );

      const [mintPDA] = PublicKey.findProgramAddressSync(
        [Buffer.from(MINT_SEED)],
        programId
      );

      console.log("Oto PDA:", otoPDA.toBase58());
      console.log("Mint PDA:", mintPDA.toBase58());

      // Calculate metadata address
      const TOKEN_METADATA_PROGRAM_ID = new PublicKey(
        "metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"
      );
      const metadataAddress = PublicKey.findProgramAddressSync(
        [
          Buffer.from("metadata"),
          TOKEN_METADATA_PROGRAM_ID.toBytes(),
          mintPDA.toBytes(),
        ],
        TOKEN_METADATA_PROGRAM_ID
      )[0];

      console.log("Oto PDA to initialize:", otoPDA.toBase58());
      console.log("Mint PDA:", mintPDA.toBase58());
      console.log("NFT Collection:", nftCollection.toBase58());
      console.log("Metadata Address:", metadataAddress.toBase58());

      // Otoã‚’åˆæœŸåŒ–
      return await program.methods
        .initializeOto()
        .accounts({
          payer: new PublicKey(address),
          nftCollection: nftCollection,
          tokenProgram: TOKEN_PROGRAM_ID,
          rent: SYSVAR_RENT_PUBKEY,
          tokenMetadataProgram: TOKEN_METADATA_PROGRAM_ID,
          metadata: metadataAddress,
        })
        .rpc();
    },
  });

  /**
   * Mutation to claim tokens
   */
  const claimTokens = useMutation({
    mutationKey: ["oto", "claim", { cluster }],
    mutationFn: async ({
      userId,
      claimAmount,
    }: {
      userId: string;
      claimAmount: number;
    }) => {
      if (!program || !address || !otoPDA || !mintPDA)
        throw new Error("Not initialized");

      // Calculate user PDA
      const shortenedUserId = getUserId(userId);
      const calculatedUserPDA = await getUserPDA(shortenedUserId);
      if (!calculatedUserPDA) throw new Error("Failed to calculate user PDA");

      // Calculate ATA
      const [userTokenAccount] = await PublicKey.findProgramAddressSync(
        [walletProvider.publicKey.toBytes()],
        ASSOCIATED_TOKEN_PROGRAM_ID
      );

      // Oto ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒ¬ãƒ¼ãƒ ã™ã‚‹
      return program.methods
        .claim(shortenedUserId, new BN(claimAmount))
        .accounts({
          beneficiary: address,
          tokenProgram: TOKEN_PROGRAM_ID,
        })
        .rpc();
    },
  });

  /**
   * Mutation to update points (for admin)
   */
  const updatePoint = useMutation({
    mutationKey: ["oto", "updatePoint", { cluster }],
    mutationFn: async ({
      userId,
      delta,
    }: {
      userId: string;
      delta: number;
    }) => {
      if (!program || !address || !otoPDA) throw new Error("Not initialized");

      // Calculate user PDA
      const shortenedUserId = getUserId(userId);
      const calculatedUserPDA = await getUserPDA(shortenedUserId);
      if (!calculatedUserPDA) throw new Error("Failed to calculate user PDA");

      // ãƒã‚¤ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹
      return program.methods
        .updatePoint(shortenedUserId, new BN(delta))
        .accounts({
          oto: otoPDA,
          user: calculatedUserPDA,
          admin: address,
        })
        .rpc();
    },
  });

  /**
   * Query to get Oto account information
   */
  const getOtoAccount = useQuery({
    queryKey: ["oto", "otoAccount", { cluster }],
    queryFn: async () => {
      if (!program || !otoPDA) throw new Error("Not initialized");
      return program.account.oto.fetch(otoPDA);
    },
    enabled: !!program && !!otoPDA,
  });

  /**
   * Query to get the claimable amount for a user
   * Automatically initializes the user if they do not exist
   */
  const getClaimableAmount = useQuery({
    queryKey: ["oto", "claimableAmount", { userId: address, cluster }],
    queryFn: async () => {
      if (!address || !program) throw new Error("Not initialized");

      try {
        const userId = address; // Use the current address as the user ID
        console.log("User ID:", userId);

        // Get user account information
        let userAccount = await getUserAccount(userId);

        console.log("User account information:", userAccount);

        if (!userAccount) {
          console.log(
            "User account is not initialized. Returning claimable amount as 0"
          );
          return "0";
        }

        // Check if claimableAmount exists
        if (userAccount.claimableAmount) {
          console.log(
            "userAccount.claimableAmount:",
            userAccount.claimableAmount
          );
          const amount = userAccount.claimableAmount.toString();
          console.log(`Claimable amount for user ${userId}: ${amount}`);
          return amount;
        }

        return "0";
      } catch (error) {
        console.error("Error fetching claimable amount:", error);
        return "0"; // Return 0 in case of error (to avoid breaking the UI)
      }
    },
    enabled: !!program && !!address && !!walletProvider,
    staleTime: 60 * 1000, // Use cache for 1 minute
    refetchOnWindowFocus: true, // Refetch on window focus
    retry: 2, // Retry 2 times on error
  });

  return {
    program,
    programId,
    otoPDA,
    mintPDA,
    getUserPDA,
    getUserAccount,
    initializeUser,
    initializeOto,
    claimTokens,
    updatePoint,
    getOtoAccount,
    getClaimableAmount,
  };
};

export default useContract;
```

ä»¥ä¸Šå®Ÿè£…ã®è§£èª¬ã«ãªã‚Šã¾ã™ï¼ï¼

## ğŸ”¥ å®Ÿéš›ã®æŒ™å‹•ã®æ§˜å­

- ãƒ­ã‚°ã‚¤ãƒ³å‰

  connect ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«æ¥ç¶šã§ãã¾ã™ï¼

  ![](/images/reown_solana_dapp/0.png)

- Wallet Connect

  ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã¯ **Phantom** ã‚„ **Backpack** ã®ä»–ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚„ Gmail ã§ã‚‚è¨­å®šå¯èƒ½ã§ã™ï¼

  ![](/images/reown_solana_dapp/0.1.png)

- ãƒ­ã‚°ã‚¤ãƒ³å¾Œ

  ãƒ­ã‚°ã‚¤ãƒ³å¾Œã¯ã€ `<appkit-button>` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¤šæ©Ÿèƒ½ãªã‚¦ã‚©ãƒ¬ãƒƒãƒˆãƒœã‚¿ãƒ³ã«æ§˜å¤‰ã‚ã‚Šï¼

  ![](/images/reown_solana_dapp/1.png)

  æ®‹é«˜ã‚„ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã—ãŸã‚Šã€æ¥ç¶šã™ã‚‹ãƒã‚§ãƒ¼ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆãŸã‚Šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼ï¼

  ![](/images/reown_solana_dapp/4.png)

  ![](/images/reown_solana_dapp/2.png)

  ç½²åå‡¦ç†ãŒå¿…è¦ãªå ´åˆã«ã¯ã€ã“ã®ã‚ˆã†ãªãƒ¢ãƒ¼ãƒ€ãƒ«ãŒç«‹ã¡ä¸ŠãŒã‚Šãƒ¦ãƒ¼ã‚¶ãƒ¼ Sign ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ã§ç½²åå‡¦ç†ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ï¼ï¼

  å•é¡ŒãŒãªã‘ã‚Œã°ãã®ã¾ã¾ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã«é€ã‚‰ã‚Œã¾ã™ï¼

  ![](/images/reown_solana_dapp/3.png)

## ğŸ“‚ ãƒªãƒã‚¸ãƒˆãƒªï¼†ãƒ‡ãƒ¢

ä»Šå›åƒ•ãŸã¡ãŒä½œã£ãŸãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ãƒªãƒã‚¸ãƒˆãƒªã‚„ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆã®ãƒªãƒ³ã‚¯ã‚’å…±æœ‰ã—ã¾ã™ï¼ï¼

ã‚‚ã—è‰¯ã‹ã£ãŸã‚‰è¦‹ã¦ã¿ã¦ãã ã•ã„ï¼ï¼

### ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒšãƒ¼ã‚¸

ä»Šå›ã€ **Oto** ã¨ã„ã†ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’é–‹ç™ºã—ã¾ã—ãŸï¼

AI ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ä¸è¶³ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ã™ï¼ï¼

https://arena.colosseum.org/projects/explore/oto

### ãƒ”ãƒƒãƒã‚¹ãƒ©ã‚¤ãƒ‰

ã¾ã å®Ÿç‰©ãŒã‚ã‚Šã¾ã›ã‚“ãŒã€AI ãƒ‡ãƒã‚¤ã‚¹ã®æ§‹æƒ³ã‚‚ã‚ã‚Šã¾ã™ï¼

https://www.figma.com/slides/zENm8UTvypmVpUscp14Imc/oto---Pitch-Deck?node-id=5-45&t=3RG8vMWEwdsLl8zv-0

### GitHub ãƒªãƒã‚¸ãƒˆãƒª

https://github.com/Heterod0x/oto

### ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆ

https://oto-gules.vercel.app/

### GitBook

https://oto-dev.gitbook.io/oto

## ã¾ã¨ã‚

**Reown SDK** ã‚’ä½¿ãˆã°ã€Solana ã‚„ EVM ãªã©ãƒãƒ«ãƒãƒã‚§ãƒ¼ãƒ³ã«å¯¾å¿œã—ãŸ Web3 ã‚¢ãƒ—ãƒªé–‹ç™ºãŒã‚°ãƒƒã¨ãƒ©ã‚¯ã«ï¼

ãœã²ä¸€åº¦é–‹ç™ºè€…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ãŸã‚Šã€ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚’è©¦ã—ãŸã‚Šã—ã¦ã¿ã¦ãã ã•ã„ï¼ï¼

ä»Šå›ã¯ã“ã“ã¾ã§ã«ãªã‚Šã¾ã™ï¼

èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼
