---
title: "Metaplexã‚’ä½¿ã£ã¦Solanaä¸Šã«NFTã‚’ãƒŸãƒ³ãƒˆã™ã‚‹APIã‚’ä½œã‚ã†ï¼"
emoji: "ğŸ› "
type: "tech" 
topics: ["NFT","Web3","Solana","Nextjs","Metaplex"]
published: true
---

## ã¯ã˜ã‚ã«

çš†ã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼

9æœˆä¸­æ—¬ã€œ10æœˆåˆæ—¬ã¾ã§é–‹å‚¬ã•ã‚Œã¦ã„ãŸ **Solana** ã®å¤§å‹ãƒãƒƒã‚«ã‚½ãƒ³ **Radar Hackathon** ã«å‚åŠ ã—ã¾ã—ãŸã€‚

ãã®æ™‚ã«NFTç‰¹åŒ–ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã©ã‚’æä¾›ã—ã¦ã„ã‚‹ **Metaplex** ã‚’ä½¿ã£ã¦ã¿ãŸã¨ã“ã‚ä½¿ã„å‹æ‰‹ãŒè‰¯ã‹ã£ãŸã®ã§è¨˜äº‹ã«ã—ã¦ã¿ã¾ã—ãŸï¼

https://www.colosseum.org/radar

åƒ•ã¯ã€ [Yukiã•ã‚“](https://twitter.com/stand_english)ã«ãŠå£°ãŒã‘ã„ãŸã ã„ã¦ AWç³»ã®ã‚²ãƒ¼ãƒ ã§ã‚ã‚‹ **Q-drop Adventure** ã¨ã„ã†ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®é–‹ç™ºã‚’ã”ä¸€ç·’ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸï¼ï¼

![](/images/36322bab97af38/1.png)

Live demoã¯ä»¥ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ï¼ï¼
ãœã²è§¦ã£ã¦ã¿ã¦ãã ã•ã„ï¼ï¼

https://qdropadventure.vercel.app/

## Metaplexã¨ã¯

**Metaplex** ã¯Solanaä¸Šã§NFTé–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æä¾›ã—ã¦ã„ã¾ã™ï¼

ä»Šå¹´ã®3æœˆã« æ–°ã—ã„NFTæ¨™æº–ã¨ãªã‚‹ã€ŒCoreã€ã¨ã„ã†ã‚‚ã®ã‚’ç™ºè¡¨ã—ã¦ã„ã¾ã™ã€‚

https://coinpost.jp/?p=519178

ä»¥ä¸‹ã®ãƒ–ãƒ­ã‚°ã§ã¯ãã® Core NFTã‚’ç™ºè¡Œã™ã‚‹æ‰‹é †ãŒä¸å¯§ã«è§£èª¬ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒä»Šå›ã¯ã“ã®å†…å®¹ã‚’å‚è€ƒã«Next.jsã«çµ„ã¿è¾¼ã‚“ã§ã¿ã¾ã—ãŸï¼ï¼

https://note.com/standenglish/n/n8f942d09ec8d

è‡ªåˆ†ã§ã‚‚è©¦ã—ã¦ã¿ãŸãƒªãƒã‚¸ãƒˆãƒªã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

https://github.com/mashharuki/metaplex_core

ã“ã£ã¡ã¯ãƒŸãƒ‹ãƒãƒ ã®ã‚³ãƒ¼ãƒ‰ã§ Metaplex Core NFTã®å®Ÿè£…ã‚’è©¦ã›ã‚‹ã®ã§ãŠã™ã™ã‚ã§ã™ï¼ï¼

## ä»Šå›ã®å®Ÿè£…

ä»Šå›å®Ÿè£…ã—ãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®GitHubãƒªãƒã‚¸ãƒˆãƒªã«å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

https://github.com/ytakahashi2020/airdrop_quest/tree/main

ã‚²ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢ã—ãŸäººã«ã¯ NFTã‚’2ç¨®é¡ãƒŸãƒ³ãƒˆã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¦ã„ã‚‹ã®ã§ã™ãŒãã®ãŸã‚ã®æ–¹æ³•ã¨ã—ã¦ **Metaplex** ã‚’ä½¿ã„ã¾ã—ãŸï¼ï¼

ä¾‹ãˆã°ã€ WinnerNFTã‚’ç™ºè¡Œã™ã‚‹æ™‚ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ï¼

```ts
import { create, mplCore } from "@metaplex-foundation/mpl-core";
import {
  createGenericFile,
  generateSigner,
  keypairIdentity
} from "@metaplex-foundation/umi";
import { createUmi } from "@metaplex-foundation/umi-bundle-defaults";
import { irysUploader } from "@metaplex-foundation/umi-uploader-irys";
import { base58 } from "@metaplex-foundation/umi/serializers";
import fs from "fs";
import { NextResponse } from "next/server";
import path from "path";

/**
 * NFTä½œæˆç”¨ã®API
 * @returns
 */
export async function POST() {
  try {
    // UMI ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
    const umi = createUmi("https://api.devnet.solana.com")
    .use(mplCore())
    .use(
      irysUploader({
        address: "https://devnet.irys.xyz",
      })
    );

    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ã®éµãƒšã‚¢ã‚’èª­ã¿è¾¼ã‚€
    const keyData = fs.readFileSync(path.join(process.cwd(), "src", "data", "id.json"));
    const walletFile = JSON.parse(keyData.toString());
    // ã‚­ãƒ¼ãƒšã‚¢ã‚’ä½œæˆ
    let keypair = umi.eddsa.createKeypairFromSecretKey(
      new Uint8Array(walletFile)
    );
    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨ã®éµãƒšã‚¢ã¨UMIã‚’ç´ä»˜ã‘ã‚‹ã€‚
    umi.use(keypairIdentity(keypair));

    // Upload image data
    const imageFile = fs.readFileSync(path.join(process.cwd(), 'public/images/nft/winnerNft.png'));
    const umiImageFile = createGenericFile(imageFile, "image.png", {
      tags: [{ name: "Content-Type", value: "image/png" }],
    });
    console.log("Uploading Image...");
    // upload
    const imageUri = await umi.uploader.upload([umiImageFile]).catch((err) => {
      throw new Error(err);
    });
    const irysImageUri = imageUri[0].replace("arweave.net", "gateway.irys.xyz");
    console.log("imageUri: " + irysImageUri);

    const metadata = {
      name: "Q Drop Adventure Winner NFT",
      description: "This is a Q Drop Adventure Winner NFT",
      image: irysImageUri,
      external_url: "https://x.com/a_kingdom_radar",
      attributes: [
        {
          trait_type: "rarity",
          value: "max",
        },
      ],
      properties: {
        files: [
          {
            uri: imageUri[0],
            type: "image/jpeg",
          },
        ],
        category: "image",
      },
    };
  
    // Call upon umi's `uploadJson` function to upload our metadata to Arweave via Irys.
  
    console.log("Uploading Metadata...");
    const metadataUri = await umi.uploader.uploadJson(metadata).catch((err) => {
      throw new Error(err);
    });

    const irysMetadataUri = metadataUri.replace(
      "arweave.net",
      "gateway.irys.xyz"
    );
  
    console.log("metadataUri: " + irysMetadataUri);

    const asset = generateSigner(umi);

  console.log("Creating NFT...");
  // NFTã‚’ä½œæˆã™ã‚‹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç½²åã—ã¦é€ä¿¡
  const tx = await create(umi, {
    asset,
    name: "My Super NFT",
    uri: irysMetadataUri,
  }).sendAndConfirm(umi);

  // Finally we can deserialize the signature that we can check on chain.
  const signature = base58.deserialize(tx.signature)[0];

  // Log out the signature and the links to the transaction and the NFT.
  console.log("\nNFT Created");
  console.log("View Transaction on Solana Explorer");
  console.log(`https://explorer.solana.com/tx/${signature}?cluster=devnet`);
  console.log("\n");
  console.log("View NFT on Metaplex Explorer");
  console.log(
    `https://core.metaplex.com/explorer/${asset.publicKey}?env=devnet`
  );

  return NextResponse.json({
    txHash: `https://explorer.solana.com/tx/${signature}?cluster=devnet`,
    metaplexUrl: `https://core.metaplex.com/explorer/${asset.publicKey}?env=devnet`,
  })

  } catch (error) {
    console.error("error:", error);
    throw error;
  }
}
```

ç™ºè¡Œã®éš›ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãŒå¿…è¦ã«ãªã‚‹ã®ã§ã™ãŒã€ä»Šå›ã¯ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’æŒã£ã¦ã„ãªã„äººã§ã‚‚ç™ºè¡Œã§ãã‚‹ã‚ˆã†ã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’ç”¨æ„ã—ã¦ãã“ã‹ã‚‰ç™ºè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼

:::message
ã“ã®æ–¹æ³•ã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šå•é¡ŒãŒã‚ã‚‹ã®ã§ä»Šå¾Œä¿®æ­£ã™ã‚‹äºˆå®šã§ã™ã€‚
:::

ä¸Šã‹ã‚‰é †ã« 

- **UMIã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è¨­å®š**
- **ç”»åƒãƒ‡ãƒ¼ã‚¿ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**
- **NFTãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è¨­å®š**
- **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**
- **NFTã®ç™ºè¡Œ**

ã¨ã„ã†å®Ÿè£…ã«ãªã£ã¦ã„ã¾ã™ï¼ï¼

**Areweave** ä¸Šã«ç”»åƒãƒ‡ãƒ¼ã‚¿ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã¦ã„ã‚‹ã‚‰ã—ã„ã®ã§ã™ãŒã€ãã®æ™‚ã«å¿…è¦ãªè³‡ç”£ã‚‚ **SOL** ã§OKã§ã™ï¼ï¼

**ã“ã“ãŒMetaplexã®ä½¿ã„ã‚„ã™ã„ç‚¹ã ãªã¨æ€ã„ã¾ã—ãŸï¼ï¼**

## å‹•ã‹ã—ã¦ã¿ãŸï¼

ã§ã¯ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å‹•ã‹ã—ã¦ã¿ã¾ã™ï¼ï¼

ã¾ãšãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’èµ·å‹•ã—ã¾ã™ï¼ï¼

```bash
yarn dev
```

ãã®å¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã£ã¦ APIã‚’å‘¼ã³å‡ºã—ã¦ã¿ã¾ã™ï¼ï¼

```bash
curl -XPOST "http://localhost:3000/api/nft/mint/winnerNft"
```

ã—ã°ã‚‰ãå¾…ã¤ã¨ãƒ»ãƒ»ãƒ»

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä¸Šã«ã¯ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼ï¼

```bash
bigint: Failed to load bindings, pure JS will be used (try npm run rebuild?)
Uploading Image...
imageUri: https://gateway.irys.xyz/5TLfaC5dSK6JYHtEcrPXVXVjqYq91YvE68UqzqVWYQ1C
Uploading Metadata...
metadataUri: https://gateway.irys.xyz/CidsQDowbZKjUarbqyXi8PV1GNMaRWAesVy9bPM5Kdmn
Creating NFT...

NFT Created
View Transaction on Solana Explorer
https://explorer.solana.com/tx/4PLrhxdVdaD1xkUzcUbUGgW4vvE3FAjFZ1MdjRDFGkXS2DLZ5K7vFm1Cqk1Vcua4fvdM12C7u324yWofDcd7D87o?cluster=devnet


View NFT on Metaplex Explorer
https://core.metaplex.com/explorer/Bor7wL2cKrJzQkPXSMzpZ1pTVfrew2LH2XF9bEb8YPdX?env=devnet
 POST /api/nft/mint/winnerNft 200 in 45673ms
```

çµæœã¨ã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã¨NFTã¾ã§ã®URLãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼ï¼

```json
{
  "txHash":"https://explorer.solana.com/tx/4PLrhxdVdaD1xkUzcUbUGgW4vvE3FAjFZ1MdjRDFGkXS2DLZ5K7vFm1Cqk1Vcua4fvdM12C7u324yWofDcd7D87o?cluster=devnet",
  "metaplexUrl":"https://core.metaplex.com/explorer/Bor7wL2cKrJzQkPXSMzpZ1pTVfrew2LH2XF9bEb8YPdX?env=devnet"
}
```

ç„¡äº‹ã«NFTãŒç™ºè¡Œã•ã‚ŒãŸã‚ˆã†ã§ã™ï¼ï¼

å¿µã®ç‚ºä¸¡æ–¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ç¢ºèªã—ã¦ã¿ã¾ã™ï¼ï¼

https://explorer.solana.com/tx/4PLrhxdVdaD1xkUzcUbUGgW4vvE3FAjFZ1MdjRDFGkXS2DLZ5K7vFm1Cqk1Vcua4fvdM12C7u324yWofDcd7D87o?cluster=devnet

https://core.metaplex.com/explorer/Bor7wL2cKrJzQkPXSMzpZ1pTVfrew2LH2XF9bEb8YPdX?env=devnet

ã¡ã‚ƒã‚“ã¨ç™ºè¡Œã§ãã¦ã„ã¾ã—ãŸï¼ï¼

![](/images/36322bab97af38/2.png)

## ã¾ã¨ã‚

ã„ã‹ãŒã§ã—ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿï¼Ÿ

æ™®æ®µã¯ **Solana** ç³»ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚„SDKã«ã¯è§¦ã‚Œãªã„ã®ã§ã™ãŒã€ä»Šå›ã¯ãƒãƒƒã‚«ã‚½ãƒ³ã¨ã„ã†ã“ã¨ã§ã¡ã‚‡ã£ã¨è§¦ã‚Œã¦ã¿ã¾ã—ãŸï¼

ç”»åƒã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‹ã‚‰NFTç™ºè¡Œã¾ã§ä¸€æ°—é€šè²«ã§ã§ãã‚‹ã®ã§ **Metaplex** ã¯éå¸¸ã«ä½¿ã„å‹æ‰‹ãŒè‰¯ã„ã¨æ€ã„ã¾ã—ãŸï¼ï¼ï¼

çš†ã•ã‚“ã‚‚è§¦ã£ã¦ã¿ã¦ãã ã•ã„ï¼ï¼

ã¾ãŸã€æœ€å¾Œã«ãªã‚Šã¾ã™ãŒåƒ•ãŸã¡ã®ãƒãƒ¼ãƒ ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ã‚ã‚‹ **Q Drop Adventure** ã‚’å¿œæ´ã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¤§å¤‰å¬‰ã—ã„ã§ã™ï¼ï¼

ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒšãƒ¼ã‚¸ã¯ä»¥ä¸‹ã§ã™ï¼

https://arena.colosseum.org/refresh-session?redirectBack=/projects/hackathon/q-drop-adventure

ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ãƒ”ãƒƒãƒè³‡æ–™ã‚„ãƒ“ãƒ‡ã‚ªã¯ä»¥ä¸‹ã§ç¢ºèªãŒã§ãã¾ã™ï¼ï¼  
è‰¯ã‹ã£ãŸã‚‰è¦‹ã¦ã¿ã¦ãã ã•ã„ï¼ï¼

https://www.loom.com/share/b1b8d8710510400cacf7ecfeca59c4f1

https://www.canva.com/design/DAGSeD3VV-8/7NY0PWR8QbAc5Cje4XG94g/watch?embed

ä»Šå›ã¯ä»¥ä¸Šã¨ãªã‚Šã¾ã™ï¼ï¼

ã“ã“ã¾ã§èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼ï¼

### å‚è€ƒæ–‡çŒ®

1. [GitHub - Q-drop Adventure](https://github.com/ytakahashi2020/airdrop_quest/tree/main)
2. [Metaplexã®å…¬å¼ã‚µã‚¤ãƒˆ](https://www.metaplex.com/)
3. [Radar Hackathon å…¬å¼ã‚µã‚¤ãƒˆ](https://www.colosseum.org/radar)
4. [ã€å®Œå…¨ä¿å­˜ç‰ˆã€‘Irysã‚’ä½¿ã£ã¦Metaplexã®Core NFTã‚’ä½œæˆã—ã‚ˆã†ï¼](https://note.com/standenglish/n/n8f942d09ec8d)
