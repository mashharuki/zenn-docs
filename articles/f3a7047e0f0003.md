---
title: "Hats Protocolã‚’ç†è§£ã™ã‚‹3ï¼ï¼"
emoji: "ğŸ±"
type: "tech"
topics: ["TypeScript", "Solidity", "Blockchain", "Web3", "HatsProtocol"]
published: true
---

![](/images/4fc8bb038497aa/0.png)

## ã¯ã˜ã‚ã«

ã“ã®è¨˜äº‹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã®ç¶šãã«ãªã‚Šã¾ã™ï¼ï¼

https://zenn.dev/mashharuki/articles/4fc8bb038497aa

å‰å›ã¾ã§ Hats Module SDKã®æ¦‚è¦ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã—ãŸã€‚

ä»Šå›ã¯ãã®ç¶šãã§ **Hats Signer Gate SDK** ã€ **Hats Account SDK** ã«ã¤ã„ã¦ã¾ã¨ã‚ãŸè¨˜äº‹ã«ãªã‚Šã¾ã™ï¼ï¼

## Hats Account SDK

**HatsAccount**ã¯ã€Hats Protocolã®å„ãƒãƒƒãƒˆã«ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚

å„ãƒãƒƒãƒˆã«ã¯ã€**ERC6551**è¦æ ¼ã«æº–æ‹ ã—ã€ERC6551Registryãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã‚’ä»‹ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã‚‹è¤‡æ•°ã®HatsAccountã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã™ã€‚

HatsAccountã«ã‚ˆã‚Šã€å„ãƒãƒƒãƒˆã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æŒã¤ã“ã¨ãŒã§ãã¾ã™:

- ETHã€ERC20ã€ERC721ã€ERC1155ãƒˆãƒ¼ã‚¯ãƒ³ã®é€ä¿¡
- ãƒãƒ«ãƒã‚·ã‚°ã®ç½²åè€…ã¨ã—ã¦ã€ERC1271äº’æ›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ç½²å
- DAOã®ãƒ¡ãƒ³ãƒãƒ¼ã«ãªã‚Šã€ææ¡ˆã‚’è¡Œã£ãŸã‚Šã€æŠ•ç¥¨ã—ãŸã‚Šã™ã‚‹ï¼ˆä¾‹ï¼šMoloch DAOï¼‰
- ä»–ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™
- okenboundã®ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’åˆ©ç”¨ã—ã¦ã€ä»–ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã«`Delegatecall`
- ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ™ãƒ¼ã‚¹ã®ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚¹ã‚­ãƒ¼ãƒ ã«ãŠã‘ã‚‹æ¨©é™ã®ä»˜ä¸

æœ€åˆã¨æœ€å¾Œã‚’é™¤ãã“ã‚Œã‚‰ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã™ã¹ã¦ã€ãƒãƒƒãƒˆã®ç€ç”¨è€…ã«ã‚ˆã£ã¦è¡Œã‚ã‚Œã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ã¯HatsAccountã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦æ±ºã¾ã‚Šã¾ã™ã€‚

ã“ã®SDKã¯ã€Hats Accountã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆã‚„æ“ä½œã‚’è¡Œã†ãŸã‚ã®ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã®JavaScriptã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã‚ã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ã¨Node.jsã®ä¸¡æ–¹ã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

### 1 of N Hats Account

HatsAccount1ofN ã¯ã€å…¸å‹çš„ãª1-of-nã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ã‚’åæ˜ ã—ãŸHatsAccountã®ä¸€ã¤ã§ã™ã€‚

ã“ã®ãƒ¢ãƒ‡ãƒ«ã§ã¯ã€HatsAccount1ofNã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å¸½å­ã‚’ã‹ã¶ã‚‹ã©ã®å€‹äººã§ã‚‚ã€ãã®HatsAccountã‚’å®Œå…¨ã«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è¤‡æ•°ã®å€‹äººãŒåŒã˜å¸½å­ã‚’ã‹ã¶ã£ã¦ã„ã‚‹å ´åˆã€ãã‚Œãã‚ŒãŒç‹¬ç«‹ã—ã¦å®Œå…¨ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«æ¨©ã‚’æŒã¡ã¾ã™ã€‚

HatsProtocolç‰ˆã®ãƒãƒ«ãƒã‚·ã‚°ã£ã¦æ„Ÿã˜ã§ã™ã‹ã­ã€‚

- #### Getting Started

  Hats Account SDKã‚’ä½¿ã†æ™‚ã¯ã¾ãšä»¥ä¸‹ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

  ```bash
  yarn add @hatsprotocol/hats-account-sdk viem
  ```

  ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç”Ÿæˆã™ã‚Œã°è‰¯ã„ã¿ãŸã„ã§ã™ï¼ï¼

  ã“ã‚Œã¾ã§ã®SDKã¨åŒã˜ã§ã™ã­ï¼

  ```ts
  import { HatsAccount1ofNClient } from "@hatsprotocol/hats-account-sdk";

  const hatsAccount1ofNClient = new HatsAccount1ofNClient({
      publicClient,
      walletClient,
  });
  ```

- #### Creating New Instances

  - **createAccount**

    1 of N Hats Account ã®æ–°ã—ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

    ```ts
    /**
     * @param {Account | Address} account - Viem ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆJSON-RPC ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å ´åˆã¯ Addressã€ãã‚Œä»¥å¤–ã®ã‚¿ã‚¤ãƒ—ã®å ´åˆã¯ Accountï¼‰ã€‚
     * @param {bigint} hatId - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹å¯¾è±¡ã®å¸½å­IDã€‚
     * @param {bigint} salt - ä»»æ„ã®æ•°å€¤ï¼ˆ"ã‚½ãƒ«ãƒˆ"ã¨ã—ã¦ä½¿ç”¨ï¼‰ã€‚
     * @return {Object} - ä½œæˆçµæœã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚
     */
    const createHatsAccountResult = await hatsAccount1ofNClient.createAccount({
        account,
        hatId,
        salt,
    });
    ```

  - **predictAccountAddress**

    1 of N Hats Account ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚

    ```ts
    /**
     * @param {bigint} hatId - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹å¯¾è±¡ã®å¸½å­IDã€‚
     * @param {bigint} salt - ä»»æ„ã®æ•°å€¤ï¼ˆ"ã‚½ãƒ«ãƒˆ"ã¨ã—ã¦ä½¿ç”¨ï¼‰ã€‚
     * @return {string} - äºˆæ¸¬ã•ã‚Œã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚
     */
    const predictedAccount = await hatsAccount1ofNClient.predictAccountAddress({
        hatId,
        salt,
    });
    ```

- #### Executing From An Instance

  Hats Account ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‹ã‚‰æ“ä½œã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã›ã‚‹ã®ã¯ã€ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å¸½å­ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã§ã™ã€‚

  - **execute**

    ```ts
    /**
     * @param {Account | Address} account - Viem ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆJSON-RPC ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å ´åˆã¯ Addressã€ãã‚Œä»¥å¤–ã®ã‚¿ã‚¤ãƒ—ã®å ´åˆã¯ Accountï¼‰ã€‚
     * @param {Address} instance - Hats Account ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚
     * @param {Operation} operation - æ“ä½œã®å®Ÿè¡Œãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ Operation ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚
     * @return {Object} - å®Ÿè¡Œçµæœã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚
     */
    const executionResult = await hatsAccount1ofNClient.execute({
        account,
        instance,
        operation,
    });
    ```

  - **executeBatch**

    ä¸€é€£ã®æ“ä½œã‚’ä¸€æ‹¬ã§å®Ÿè¡Œã—ã¾ã™ã€‚

    ```ts
    /**
     * @param {Account | Address} account - Viem ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆJSON-RPC ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å ´åˆã¯ Addressã€ãã‚Œä»¥å¤–ã®ã‚¿ã‚¤ãƒ—ã®å ´åˆã¯ Accountï¼‰ã€‚
     * @param {Address} instance - Hats Account ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‚
     * @param {Operation[]} operations - å„æ“ä½œã®å®Ÿè¡Œãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ Operation ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã€‚
     * @return {Object} - å®Ÿè¡Œçµæœã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‚
     */
    const executionResult = await hatsAccount1ofNClient.executeBatch({
        account,
        instance,
        operations,
    });
    ```

- #### Type

  - **Operation**

    Hats Account ã®æ“ä½œã«é–¢ã™ã‚‹å®Ÿè¡Œãƒ‡ãƒ¼ã‚¿ã€‚

    ```ts
    {
      to: Address; // æ“ä½œã®ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹
      value: bigint; // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«é€ä¿¡ã•ã‚Œã‚‹Etherã®å€¤
      data: Hex; // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ“ä½œã®ã‚³ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿
      operation: OperationType; // å®Ÿè¡Œã™ã‚‹æ“ä½œã®ç¨®é¡ã‚’ç¤ºã™ OperationType ã®å€¤
    }
    ```

  - **OperationType**

    å®Ÿè¡Œã™ã‚‹æ“ä½œã‚’ç¤ºã™åˆ—æŒ™å‹ã€‚

    ```ts
    {
      Call,         // é€šå¸¸ã®ã‚³ãƒ¼ãƒ«æ“ä½œ
      DelegateCall, // ãƒ‡ãƒªã‚²ãƒ¼ãƒˆã‚³ãƒ¼ãƒ«æ“ä½œ
    }
    ```

  - **CreateAccountResult**

    ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã®çµæœã€‚

    ```ts
    {
      status: "success" | "reverted"; // æˆåŠŸã—ãŸå ´åˆã¯ "success"ã€å¤±æ•—ã—ãŸå ´åˆã¯ "reverted"
      transactionHash: Address; // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚·ãƒ¥å€¤
      newAccount: Address; // æ–°ã—ãä½œæˆã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ã‚¢ãƒ‰ãƒ¬ã‚¹
    }
    ```

  - **ExecutionResult**

    Hats Account ã®å®Ÿè¡Œçµæœã€‚

    ```ts
    {
      status: "success" | "reverted"; // æˆåŠŸã—ãŸå ´åˆã¯ "success"ã€å¤±æ•—ã—ãŸå ´åˆã¯ "reverted"
      transactionHash: Address; // ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚·ãƒ¥å€¤
    }
    ```

ä»Šå›ã¯ã“ã“ã¾ã§ã«ãªã‚Šã¾ã™ï¼ï¼

èª­ã‚“ã§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼ï¼