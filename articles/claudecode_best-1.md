---
title: "Best Practices for Claude Codeを読んでみた"
emoji: "🛠"
type: "tech" 
topics: ["Claude","生成AI","コーディングエージェント","コンテキスト","AIエージェント"]
published: true
---

Anthropic社から発表されている **Best Practices for Claude Cod** の解説と気づきをシェアするために記事化しました！

ぜひ最後まで読んでいってください！

## 公式ページのリンク

https://code.claude.com/docs/en/best-practices#develop-your-intuition

## Best Practices for Claude Codeのポイントまとめ

原文を訳しながらまとめています！

### Claude Code ベストプラクティス

:::message
「やりたいこと」を伝えるだけでClaude Code は **調査 → 設計 → 実装** までを実行できるが、この自律性には **学習コスト**もあることを忘れずにいることが重要
:::

### コンテキスト管理は最重要

ほぼすべてのベストプラクティスには、次の制約が付きまとうことを理解しておくことが重要みたいです。

> **Claude のコンテキストウィンドウはすぐに埋まり、埋まるほど性能が落ちる**

コンテキストには以下のことが含まれます。

* 会話の全文
* Claude が読んだすべてのファイル
* 実行したコマンドの出力

デバッグやコード探索を一度行うだけで、**数万トークン** 消費することも珍しくないですよね。

コンテキストがいっぱいになるとミスが増えたり、以前の会話の内容を忘れてしまうので性能を落とさないためにも**コンテキスト管理は最重要リソース管理**だそうです。

### Claude が自分で検証できるようにする

:::message
**テスト・スクリーンショット・期待される出力を必ず与えること。**
**これが最も効果の高い施策です。**
:::

Claude は、自分で結果を検証できると **圧倒的に性能が上がる**そうです。

* テストを実行できる
* スクリーンショットを比較できる
* 出力を検証できる

#### 良い指示と悪い指示の例

| 戦略         | 悪い例            | 良い例                                                                                                                                       |
| ---------- | -------------- | ----------------------------------------------------------------------------------------------------------------------------------------- |
| 検証条件を与える   | 「メール検証関数を作って」  | 「validateEmail 関数を実装。[user@example.com](mailto:user@example.com) は true、invalid は false、[user@.com](mailto:user@.com) は false。実装後にテストを実行」 |
| UI を目視検証   | 「ダッシュボードを良くして」 | 「このスクショ通りに実装し、完成後のスクショを比較して差分を修正」                                                                                                         |
| 症状でなく原因を直す | 「ビルドが落ちる」      | 「このエラーでビルドが失敗する。根本原因を直し、ビルド成功を確認。エラーの握り潰しは禁止」                                                                                             |

検証はテスト、lint、bash コマンドなど何でも構いません。

**検証の堅牢さに投資**するのが良いとのこと。

### まず調査、次に計画、最後に実装

:::message
**調査・計画と実装を分離すること**
:::

いきなりコードを書かせると **「正しく動くが、そもそも問題を取り違えている」** コードを生成する確率が上がるため以下のようなフローが推奨されていました。

#### 推奨ワークフロー（4フェーズ）

1. **Explore（調査）**

   * Plan Mode に入る
   * ファイルを読み、理解するだけ（変更しない）

2. **Plan（設計）**

   * どのファイルをどう変えるか、詳細な計画を作らせる

3. **Implement（実装）**

   * 通常モードで実装
   * 計画と照らし合わせて検証

4. **Commit（提出）**

   * 意味のあるコミットメッセージでコミット & PR 作成

小さな修正（typo、ログ追加、変数名変更）なら**計画フェーズは不要**でも良いそうです。

> 差分を1文で説明できるなら、計画のステップは飛ばしても良いそうです

---

### プロンプトには具体的な文脈を与える

> **指示が具体的であるほど、修正回数は減ります。**

Claude は意図を推測できますが、人間の心は読めません。

#### 良いプロンプトと悪いプロンプトの例

| 戦略       | 悪い例              | 良い例                                        |
| -------- | ---------------- | ------------------------------------------ |
| スコープ指定   | 「foo.py のテストを追加」 | 「ログアウト状態のエッジケースをテスト。モックは禁止」                |
| 情報源指定    | 「なぜ API が変？」     | 「ExecutionFactory の git 履歴を調べて API の経緯を要約」 |
| 既存パターン参照 | 「カレンダーを追加」       | 「既存ウィジェット実装を参考に、同じ設計でカレンダーを追加」             |
| 症状を明確化   | 「ログインバグ直して」      | 「セッション切れ後にログイン失敗。再現テストを書いて修正」              |

### 十分な情報を参照させる

:::message
**`@` でファイル参照、画像貼り付け、データ直渡しを活用することが重要とのこと**
:::

Claudeに十分な情報を参照させることが生成するコードの質を上げる上で重要だそうです！  

参照の方法として、具体的には以下の方法が紹介されていました。

* `@file/path` で直接ファイル参照
* スクリーンショットを貼り付け
* URL で公式ドキュメント指定
* `cat error.log | claude` でログ送信
* 「必要な情報は自分で取得して」と指示してもOK

### CLAUDE.md を正しく書く

:::message
CLAUDE.md は、**`/init` で雛形を生成し、少しずつ育てる**
:::

CLAUDE.md に含めるべきものとして以下のようなことが挙げられていました。

* コードスタイル
* 実行すべきコマンド
* ワークフローの癖
* プロジェクト固有の注意点

**短く・人が読めることが重要**みたいです！

#### CLAUDE.md に含めるべきかどうかの基準

> 「これを消したら Claude はミスするか？」
> → No なら削除

長すぎる CLAUDE.md は、**全部無視される原因**になるそうです....

めちゃくちゃ長く書いてました...笑

見直さないと！

### セッション管理は積極的に行う

:::message
同じ指摘を **2回以上** しているなら、`/clear` して **より良いプロンプト**を考え直してやり直すこと
:::

* `Esc`：即停止
* `Esc + Esc` / `/rewind`：巻き戻し
* `/clear`：無関係なタスク間でリセット

今まで3回とか4回似たような指示を与えていたので、これについても見直しが必要そう....

### サブエージェントを活用する

:::message
**調査は別コンテキストに担当させる**
:::

Claude が大量のファイルを読むとインコンテキストが消費されてしまいます。

そこで、**調査**のようなタスクは**Sub Agent**に担当させてコンテキストを別に消費させるようにすることが重要とのことです。

だから**SubAgent**が重要なんですね。  

これに関連して**SKILL**がなんで重要だと言われているかもなんとなく理解ができました。

https://dev.classmethod.jp/articles/try-agent-skills-anthropic-samples/

> 必要な時だけスキルを読み込むことで、常にシステムプロンプトに設定しておく必要がなくなり、AI エージェントが消費するコンテキストウィンドウやトークンの節減にもつながる

コンテキスト管理のことを考えると**Sub Agent**と**SKILL**を組み合わせて使うことがなぜ重要なのかがわかってきました。

### 直感を育てる

:::message
ベストプラクティスはあくまで出発点であって、万能ではないことを理解することが重要
:::

例えば

* あえてコンテキストを溜める方が良い場合
* 計画を飛ばす方が速い場合
* あえて曖昧に投げる方が発見がある場合

のようなケースがあるので**うまくいった時の自分のプロンプトやCLUDE.mdを振り返ることが重要**だそうです。

それがどんなドキュメントよりも強いスキルになるとのこと！！

良い**CLUDE.md**の作り方でも紹介されていたようにいろいろ試して調整していくということが大事みたいですね！

**Anthropicハッカソン優勝者のClaude Code設定集なんかはまさにその一例ですね**！

https://zenn.dev/ttks/articles/a54c7520f827be

https://github.com/affaan-m/everything-claude-code

## まとめ

評判が良かったので**Best Practices for Claude Code**を読んでみましたが非常に参考になることが書かれていました。

特に**コンテキスト管理**の重要性が強調されていたのが印象的でしたね。

**Sub Agent**と**SKILL**をもっと上手に組み合わせられるようにしていこうと思います！

ここまで読んでいただきありがとうございました！！